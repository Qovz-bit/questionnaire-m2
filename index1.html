<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questionnaire - Gestion Locative</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 { color: #667eea; font-size: 2.5em; margin-bottom: 10px; }
        h2 { color: #333; font-size: 1.5em; margin-bottom: 20px; }
        h3 { color: #667eea; margin-bottom: 15px; margin-top: 25px; }
        .subtitle { color: #666; font-size: 1.1em; margin-bottom: 30px; }
        .intro-text { color: #555; font-size: 1.05em; margin-bottom: 25px; line-height: 1.6; }
        .question { margin-bottom: 30px; }
        .question h2 { color: #333; font-size: 1.3em; margin-bottom: 15px; }
        .question-helper { color: #888; font-size: 0.9em; margin-bottom: 10px; font-style: italic; }
        .options { display: flex; flex-direction: column; gap: 10px; }
        .option {
            padding: 15px 20px;
            background: #f5f5f5;
            border: 2px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }
        .option:hover { background: #e3f2fd; border-color: #667eea; }
        .option.selected { background: #667eea; color: white; border-color: #667eea; }
        .button {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }
        .button:hover { background: #5568d3; transform: translateY(-2px); }
        .button:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        .button-small { padding: 8px 16px; font-size: 0.9em; margin: 5px; }
        .button-danger { background: #dc3545; }
        .button-danger:hover { background: #c82333; }
        .button-success { background: #28a745; }
        .button-success:hover { background: #218838; }
        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .progress-fill { height: 100%; background: #667eea; transition: width 0.3s; }
        .nav-buttons { display: flex; gap: 10px; margin-top: 20px; }
        .back-button { background: #999; }
        .back-button:hover { background: #777; }
        textarea, input[type="text"], input[type="password"], select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-family: inherit;
            font-size: 1em;
            margin-bottom: 10px;
        }
        textarea { resize: vertical; min-height: 100px; }
        textarea:focus, input:focus, select:focus { outline: none; border-color: #667eea; }
        .success-message { text-align: center; padding: 60px 20px; }
        .success-message h2 { color: #667eea; font-size: 2.5em; margin-bottom: 20px; }
        .loading { text-align: center; padding: 40px; }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error-message {
            background: #fee;
            border: 2px solid #fcc;
            color: #c00;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .hidden { display: none; }
        .admin-link {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            font-size: 0.9em;
            transition: all 0.3s;
            cursor: pointer;
            border: none;
        }
        .admin-link:hover { background: rgba(0,0,0,0.9); }
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
            flex-wrap: wrap;
        }
        .admin-tab {
            padding: 15px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 0.95em;
            color: #666;
            transition: all 0.3s;
        }
        .admin-tab:hover { color: #667eea; }
        .admin-tab.active { color: #667eea; border-bottom-color: #667eea; font-weight: bold; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }
        .stat-label { font-size: 0.9em; opacity: 0.9; margin-bottom: 5px; }
        .stat-value { font-size: 2.5em; font-weight: bold; }
        .hypothesis-card {
            background: white;
            border: 3px solid #e0e0e0;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        .hypothesis-card.validated {
            border-color: #28a745;
            background: #f0fff4;
        }
        .hypothesis-card.rejected {
            border-color: #dc3545;
            background: #fff5f5;
        }
        .hypothesis-card.pending {
            border-color: #ffc107;
            background: #fffbf0;
        }
        .hypothesis-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .hypothesis-result {
            font-size: 1.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        .hypothesis-detail {
            color: #666;
            font-size: 0.95em;
            line-height: 1.6;
        }
        .chart-section { margin-bottom: 30px; }
        .chart-bar { margin-bottom: 15px; }
        .chart-label { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.9em; }
        .bar-container { height: 30px; background: #f0f0f0; border-radius: 5px; overflow: hidden; }
        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            padding-left: 10px;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }
        .insight-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }
        .badge-success { background: #28a745; color: white; }
        .badge-danger { background: #dc3545; color: white; }
        .badge-warning { background: #ffc107; color: #000; }
    </style>
</head>
<body>
    <div class="container">
        <!-- USER VIEW -->
        <div id="userView">
            <div id="intro">
                <h1>üìã Questionnaire</h1>
                <p class="intro-text">La vie de locataire, c'est souvent gal√®re : paperasse, litiges, caution... Et si un service s'occupait de TOUT pour vous ?</p>
                <p class="subtitle">Ce questionnaire prend 3 minutes. Vos r√©ponses sont anonymes et nous aident √† cr√©er un service utile.</p>
                <button class="button" onclick="startSurvey()">Commencer le questionnaire</button>
            </div>
            
            <div id="surveyQuestions" class="hidden">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar" style="width: 0%"></div>
                </div>
                <p id="progressText" style="color: #666; margin-bottom: 20px;">Question 1 sur 9</p>
                <div id="questionContainer"></div>
                <div class="nav-buttons">
                    <button class="button back-button" id="prevBtn" onclick="previousQuestion()" style="display:none">‚Üê Pr√©c√©dent</button>
                    <button class="button" id="nextBtn" onclick="nextQuestion()" disabled>Suivant ‚Üí</button>
                </div>
            </div>
            
            <div id="loading" class="loading hidden">
                <div class="spinner"></div>
                <p>Enregistrement de vos r√©ponses...</p>
            </div>
            
            <div id="thankYou" class="hidden">
                <div class="success-message">
                    <h2>‚úÖ Merci pour votre participation !</h2>
                    <p class="subtitle">Vos r√©ponses ont bien √©t√© enregistr√©es et nous aident √† am√©liorer le service.</p>
                </div>
            </div>
        </div>
        
        <!-- ADMIN LOGIN -->
        <div id="adminLogin" class="hidden">
            <h1>üîê Acc√®s Admin</h1>
            <p class="subtitle">Connectez-vous pour acc√©der au dashboard</p>
            <input type="password" id="adminPassword" placeholder="Mot de passe" onkeypress="if(event.key==='Enter') adminLogin()">
            <button class="button" onclick="adminLogin()" style="width: 100%;">Se connecter</button>
            <p id="loginError" class="error-message" style="display: none;">Mot de passe incorrect</p>
            <button class="button back-button" onclick="showMainView()" style="width: 100%; margin-top: 10px;">‚Üê Retour</button>
        </div>
        
        <!-- ADMIN DASHBOARD -->
        <div id="adminDashboard" class="hidden">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h1>üë®‚Äçüíº Dashboard Admin</h1>
                <button class="button back-button" onclick="logout()">D√©connexion</button>
            </div>
            
            <div class="admin-tabs">
                <button class="admin-tab active" onclick="showAdminTab('hypotheses')">üéØ Hypoth√®ses Business</button>
                <button class="admin-tab" onclick="showAdminTab('stats')">üìä Statistiques d√©taill√©es</button>
                <button class="admin-tab" onclick="showAdminTab('segments')">üë• Segmentation</button>
                <button class="admin-tab" onclick="showAdminTab('config')">‚öôÔ∏è Configuration</button>
            </div>
            
            <!-- Hypotheses Tab -->
            <div id="adminHypotheses" class="admin-content">
                <div style="margin-bottom: 20px;">
                    <button class="button button-success button-small" onclick="refreshStats()">üîÑ Actualiser</button>
                    <button class="button button-small" onclick="exportCSV()">üì• Exporter CSV</button>
                </div>
                <p class="subtitle" id="hypCount">Chargement...</p>
                <div id="hypothesesContainer"></div>
                <div id="businessInsights"></div>
            </div>
            
            <!-- Stats Tab -->
            <div id="adminStats" class="admin-content hidden">
                <div class="stats-grid" id="statsGrid"></div>
                <div id="chartsContainer"></div>
            </div>
            
            <!-- Segments Tab -->
            <div id="adminSegments" class="admin-content hidden">
                <div id="segmentationContainer"></div>
            </div>
            
            <!-- Config Tab -->
            <div id="adminConfig" class="admin-content hidden">
                <h3>Configuration Google Sheets</h3>
                <label>URL du script Google Apps :</label>
                <input type="text" id="googleScriptUrl" value="">
                <button class="button" onclick="saveConfig()">üíæ Sauvegarder</button>
                
                <h3 style="margin-top: 30px;">Mot de passe Admin</h3>
                <input type="password" id="newPassword" placeholder="Nouveau mot de passe">
                <button class="button" onclick="changePassword()">üîí Changer le mot de passe</button>
                
                <h3 style="margin-top: 30px;">‚ö†Ô∏è Zone de danger</h3>
                <button class="button button-danger" onclick="clearAllData()">üóëÔ∏è Effacer toutes les donn√©es</button>
            </div>
        </div>
    </div>
    
    <button class="admin-link" onclick="showAdminLogin()">üîê Admin</button>

    <script>
        // Configuration
        const ADMIN_PASSWORD_KEY = 'admin_password';
        const GOOGLE_URL_KEY = 'google_script_url';
        const RESPONSES_KEY = 'survey_responses';
        
        let adminPassword = localStorage.getItem(ADMIN_PASSWORD_KEY) || 'admin123';
        let GOOGLE_SCRIPT_URL = localStorage.getItem(GOOGLE_URL_KEY) || 'https://script.google.com/macros/s/AKfycbzfdLjPqSx6a1aoOWA-cQsZ2GOTqQlMu2oF5zC3FyGYgehr2FVnQQyieoGqwpwwAIoz/exec';
        
        const questions = [
            {
                id: 'profil',
                question: 'Vous √™tes... ?',
                type: 'single',
                options: ['√âtudiant(e) ‚Ä¢ 18-24 ans', 'Salari√©(e) ‚Ä¢ 25-34 ans', 'Salari√©(e) ‚Ä¢ 35+ ans', 'Ind√©pendant(e) / Autre']
            },
            {
                id: 'situation',
                question: 'Situation actuelle ?',
                type: 'single',
                options: ['Je suis locataire actuellement', 'Je suis propri√©taire', 'Je recherche un logement', 'Autre situation']
            },
            {
                id: 'difficultes',
                question: 'Quelles difficult√©s rencontrez-vous en tant que locataire ?',
                helper: 'Plusieurs choix possibles',
                type: 'multiple',
                options: [
                    'D√©marches administratives (APL, attestations, courriers...)',
                    'R√©cup√©ration de la caution',
                    'Contrats √©nergie/assurance trop chers',
                    'M√©connaissance de mes droits face au propri√©taire',
                    'Litiges ou tensions avec le propri√©taire/agence',
                    'Charges √©lev√©es ou incompr√©hensibles',
                    'Manque de temps pour g√©rer tout cela',
                    'Aucune difficult√© particuli√®re'
                ]
            },
            {
                id: 'perte_argent',
                question: 'Avez-vous d√©j√† perdu de l\'argent √† cause d\'un probl√®me locatif ?',
                helper: 'Caution non restitu√©e, charges abusives, mauvais contrats...',
                type: 'single',
                options: ['Oui, plus de 500‚Ç¨', 'Oui, entre 100‚Ç¨ et 500‚Ç¨', 'Oui, moins de 100‚Ç¨', 'Non, jamais']
            },
            {
                id: 'interet',
                question: 'Seriez-vous int√©ress√©(e) par un service qui g√®re l\'ensemble de vos besoins de locataire :',
                helper: 'V√©rification de la conformit√© de votre bail et diagnostics ‚Ä¢ Optimisation de vos contrats (√©nergie, assurance) au meilleur prix ‚Ä¢ Gestion compl√®te des aides au logement (APL) ‚Ä¢ Assistance juridique en cas de litige ‚Ä¢ Automatisation des d√©marches (pr√©avis, attestations, rendez-vous...)',
                type: 'scale',
                options: ['Peu ou pas int√©ress√©(e)', 'Moyennement int√©ress√©(e)', 'Tr√®s int√©ress√©(e)', 'Extr√™mement int√©ress√©(e)']
            },
            {
                id: 'fonctionnalite',
                question: 'Quelle fonctionnalit√© vous int√©resserait le plus ?',
                helper: 'Un seul choix',
                type: 'single',
                options: [
                    'Protection juridique + suivi de caution + gestion des litiges',
                    'Optimisation des contrats au meilleur prix garanti',
                    'Automatisation des d√©marches administratives',
                    'Service complet avec tableau de bord centralis√©'
                ]
            },
            {
                id: 'prix',
                question: 'Quel prix seriez-vous pr√™t(e) √† payer mensuellement pour ce service complet ?',
                type: 'single',
                options: ['Gratuit uniquement', '5 √† 10‚Ç¨/mois', '10 √† 20‚Ç¨/mois', '20 √† 30‚Ç¨/mois', 'Plus de 30‚Ç¨/mois']
            },
            {
                id: 'utilisation',
                question: 'Si ce service √©tait disponible d√®s maintenant, l\'utiliseriez-vous ?',
                type: 'single',
                options: ['Oui, certainement', 'Oui, probablement', 'Peut-√™tre', 'Non']
            },
            {
                id: 'remarque',
                question: 'Une remarque ou suggestion ?',
                helper: 'Optionnel',
                type: 'text',
                options: []
            }
        ];
        
        let currentQ = 0;
        let answers = {};
        let responses = JSON.parse(localStorage.getItem(RESPONSES_KEY) || '[]');
        
        // Navigation
        function showMainView() {
            document.getElementById('userView').classList.remove('hidden');
            document.getElementById('adminLogin').classList.add('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('intro').classList.remove('hidden');
            document.getElementById('surveyQuestions').classList.add('hidden');
            document.getElementById('thankYou').classList.add('hidden');
        }
        
        function showAdminLogin() {
            document.getElementById('userView').classList.add('hidden');
            document.getElementById('adminLogin').classList.remove('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
        }
        
        function showAdminTab(tab) {
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.admin-content').forEach(c => c.classList.add('hidden'));
            event.target.classList.add('active');
            const tabMap = {
                'hypotheses': 'adminHypotheses',
                'stats': 'adminStats',
                'segments': 'adminSegments',
                'config': 'adminConfig'
            };
            document.getElementById(tabMap[tab]).classList.remove('hidden');
            if (tab === 'hypotheses') analyzeHypotheses();
            if (tab === 'stats') renderDetailedStats();
            if (tab === 'segments') renderSegmentation();
            if (tab === 'config') document.getElementById('googleScriptUrl').value = GOOGLE_SCRIPT_URL;
        }
        
        // User Survey
        function startSurvey() {
            currentQ = 0;
            answers = {};
            document.getElementById('intro').classList.add('hidden');
            document.getElementById('surveyQuestions').classList.remove('hidden');
            renderQuestion();
        }
        
        function renderQuestion() {
            const q = questions[currentQ];
            const container = document.getElementById('questionContainer');
            const progress = ((currentQ + 1) / questions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = `Question ${currentQ + 1} sur ${questions.length}`;
            
            let html = `<div class="question"><h2>${q.question}</h2>`;
            if (q.helper) html += `<p class="question-helper">${q.helper}</p>`;
            
            if (q.type === 'text') {
                html += `<textarea id="answer" placeholder="Votre r√©ponse...">${answers[q.id] || ''}</textarea>`;
            } else if (q.type === 'multiple') {
                html += '<div class="options">';
                q.options.forEach((opt, idx) => {
                    const selected = (answers[q.id] || []).includes(opt) ? 'selected' : '';
                    html += `<div class="option ${selected}" onclick="toggleMultipleAnswer('${q.id}', ${idx})">${opt}</div>`;
                });
                html += '</div>';
            } else {
                html += '<div class="options">';
                q.options.forEach((opt, idx) => {
                    const selected = answers[q.id] === (q.type === 'scale' ? idx : opt) ? 'selected' : '';
                    const value = q.type === 'scale' ? idx : opt;
                    html += `<div class="option ${selected}" onclick="selectAnswer('${q.id}', ${JSON.stringify(value).replace(/"/g, '&quot;')})">${opt}</div>`;
                });
                html += '</div>';
            }
            
            html += '</div>';
            container.innerHTML = html;
            
            document.getElementById('prevBtn').style.display = currentQ > 0 ? 'block' : 'none';
            document.getElementById('nextBtn').textContent = currentQ === questions.length - 1 ? '‚úì Terminer' : 'Suivant ‚Üí';
            updateNextButton();
        }
        
        function selectAnswer(id, value) {
            answers[id] = value;
            renderQuestion();
        }
        
        function toggleMultipleAnswer(id, idx) {
            const q = questions.find(q => q.id === id);
            const option = q.options[idx];
            if (!answers[id]) answers[id] = [];
            const index = answers[id].indexOf(option);
            if (index > -1) {
                answers[id].splice(index, 1);
            } else {
                answers[id].push(option);
            }
            renderQuestion();
        }
        
        function updateNextButton() {
            const q = questions[currentQ];
            let hasAnswer = false;
            if (q.type === 'text') {
                hasAnswer = true;
            } else if (q.type === 'multiple') {
                hasAnswer = answers[q.id] && answers[q.id].length > 0;
            } else {
                hasAnswer = answers[q.id] !== undefined;
            }
            document.getElementById('nextBtn').disabled = !hasAnswer;
        }
        
        function nextQuestion() {
            const q = questions[currentQ];
            if (q.type === 'text') {
                const textarea = document.getElementById('answer');
                if (textarea) answers[q.id] = textarea.value;
            }
            if (currentQ < questions.length - 1) {
                currentQ++;
                renderQuestion();
            } else {
                submitSurvey();
            }
        }
        
        function previousQuestion() {
            if (currentQ > 0) {
                currentQ--;
                renderQuestion();
            }
        }
        
        async function submitSurvey() {
            document.getElementById('surveyQuestions').classList.add('hidden');
            document.getElementById('loading').classList.remove('hidden');
            const data = { timestamp: new Date().toISOString(), ...answers };
            
            questions.forEach(q => {
                if (q.type === 'scale' && typeof data[q.id] === 'number') {
                    data[q.id] = q.options[data[q.id]];
                }
            });
            
            responses.push(data);
            localStorage.setItem(RESPONSES_KEY, JSON.stringify(responses));
            
            try {
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
            } catch (error) {
                console.error('Erreur Google Sheets:', error);
            }
            
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('thankYou').classList.remove('hidden');
            }, 1000);
        }
        
        // Admin
        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            if (password === adminPassword) {
                document.getElementById('adminLogin').classList.add('hidden');
                document.getElementById('adminDashboard').classList.remove('hidden');
                document.getElementById('loginError').style.display = 'none';
                document.getElementById('adminPassword').value = '';
                analyzeHypotheses();
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        }
        
        function logout() {
            showMainView();
        }
        
        function refreshStats() {
            analyzeHypotheses();
        }
        
        // Business Experimentation Analysis
        function analyzeHypotheses() {
            const total = responses.length;
            document.getElementById('hypCount').textContent = `Analyse bas√©e sur ${total} r√©ponse${total > 1 ? 's' : ''}`;
            
            if (total === 0) {
                document.getElementById('hypothesesContainer').innerHTML = '<p>Collectez des r√©ponses pour voir l\'analyse des hypoth√®ses</p>';
                return;
            }
            
            // H1: Les locataires rencontrent des probl√®mes co√ªteux
            const withDifficulties = responses.filter(r => {
                const diff = r.difficultes || [];
                return diff.length > 0 && !diff.includes('Aucune difficult√© particuli√®re');
            }).length;
            const withLoss = responses.filter(r => r.perte_argent && r.perte_argent !== 'Non, jamais').length;
            const h1Percent1 = (withDifficulties / total * 100).toFixed(1);
            const h1Percent2 = (withLoss / total * 100).toFixed(1);
            const h1Validated = parseFloat(h1Percent1) > 60 && parseFloat(h1Percent2) > 50;
            
            // H2: Il existe un march√© pour une solution globale
            const highInterest = responses.filter(r => {
                const int = r.interet;
                return int === 'Tr√®s int√©ress√©(e)' || int === 'Extr√™mement int√©ress√©(e)' || int === 2 || int === 3;
            }).length;
            const h2Percent = (highInterest / total * 100).toFixed(1);
            const h2Validated = parseFloat(h2Percent) > 40;
            
            // H3: Le pricing 10-20‚Ç¨/mois est acceptable
            const acceptablePricing = responses.filter(r => r.prix === '10 √† 20‚Ç¨/mois').length;
            const h3Percent = (acceptablePricing / total * 100).toFixed(1);
            const h3Validated = parseFloat(h3Percent) > 30;
            
            // H4: L'intention d'achat est forte
            const strongIntent = responses.filter(r => r.utilisation === 'Oui, certainement').length;
            const h4Percent = (strongIntent / total * 100).toFixed(1);
            const h4Validated = parseFloat(h4Percent) > 15;
            
            let html = '';
            
            // H1
            html += `<div class="hypothesis-card ${h1Validated ? 'validated' : 'rejected'}">
                <div class="hypothesis-title">
                    <span>${h1Validated ? '‚úÖ' : '‚ùå'}</span>
                    <span>H1 : Les locataires rencontrent des probl√®mes co√ªteux</span>
                    <span class="badge ${h1Validated ? 'badge-success' : 'badge-danger'}">${h1Validated ? 'VALID√âE' : 'NON VALID√âE'}</span>
                </div>
                <div class="hypothesis-result">
                    ${h1Percent1}% ont des difficult√©s ‚Ä¢ ${h1Percent2}% ont perdu de l'argent
                </div>
                <div class="hypothesis-detail">
                    <strong>Crit√®re :</strong> > 60% avec difficult√©s ET > 50% ayant perdu de l'argent<br>
                    <strong>R√©sultat :</strong> ${withDifficulties}/${total} ont des difficult√©s (${h1Percent1}%) ‚Ä¢ ${withLoss}/${total} ont perdu de l'argent (${h1Percent2}%)<br>
                    <strong>Conclusion :</strong> ${h1Validated ? 'Le probl√®me est r√©el et co√ªteux pour les locataires. Pain point valid√©.' : 'Le probl√®me n\'est pas suffisamment douloureux ou r√©pandu. Repositionnement n√©cessaire.'}
                </div>
            </div>`;
            
            // H2
            html += `<div class="hypothesis-card ${h2Validated ? 'validated' : 'rejected'}">
                <div class="hypothesis-title">
                    <span>${h2Validated ? '‚úÖ' : '‚ùå'}</span>
                    <span>H2 : Il existe un march√© pour une solution globale</span>
                    <span class="badge ${h2Validated ? 'badge-success' : 'badge-danger'}">${h2Validated ? 'VALID√âE' : 'NON VALID√âE'}</span>
                </div>
                <div class="hypothesis-result">
                    ${h2Percent}% tr√®s/extr√™mement int√©ress√©s
                </div>
                <div class="hypothesis-detail">
                    <strong>Crit√®re :</strong> > 40% tr√®s ou extr√™mement int√©ress√©s<br>
                    <strong>R√©sultat :</strong> ${highInterest}/${total} sont tr√®s int√©ress√©s (${h2Percent}%)<br>
                    <strong>Conclusion :</strong> ${h2Validated ? 'Fort int√©r√™t pour la solution. Le march√© est valid√©.' : 'Int√©r√™t insuffisant. Le concept doit √™tre retravaill√© ou mieux communiqu√©.'}
                </div>
            </div>`;
            
            // H3
            html += `<div class="hypothesis-card ${h3Validated ? 'validated' : 'rejected'}">
                <div class="hypothesis-title">
                    <span>${h3Validated ? '‚úÖ' : '‚ùå'}</span>
                    <span>H3 : Le pricing 10-20‚Ç¨/mois est acceptable</span>
                    <span class="badge ${h3Validated ? 'badge-success' : 'badge-danger'}">${h3Validated ? 'VALID√âE' : 'NON VALID√âE'}</span>
                </div>
                <div class="hypothesis-result">
                    ${h3Percent}% acceptent 10-20‚Ç¨/mois
                </div>
                <div class="hypothesis-detail">
                    <strong>Crit√®re :</strong> > 30% acceptent la tranche 10-20‚Ç¨/mois<br>
                    <strong>R√©sultat :</strong> ${acceptablePricing}/${total} acceptent ce prix (${h3Percent}%)<br>
                    <strong>Conclusion :</strong> ${h3Validated ? 'Le pricing est valid√©. Positionnement √† 12-15‚Ç¨/mois recommand√©.' : 'Le prix est trop √©lev√© ou mal positionn√©. R√©vision du pricing n√©cessaire.'}
                </div>
            </div>`;
            
            // H4
            html += `<div class="hypothesis-card ${h4Validated ? 'validated' : 'rejected'}">
                <div class="hypothesis-title">
                    <span>${h4Validated ? '‚úÖ' : '‚ùå'}</span>
                    <span>H4 : L'intention d'achat est forte</span>
                    <span class="badge ${h4Validated ? 'badge-success' : 'badge-danger'}">${h4Validated ? 'VALID√âE' : 'NON VALID√âE'}</span>
                </div>
                <div class="hypothesis-result">
                    ${h4Percent}% utiliseraient certainement le service
                </div>
                <div class="hypothesis-detail">
                    <strong>Crit√®re :</strong> > 15% r√©pondent "Oui, certainement"<br>
                    <strong>R√©sultat :</strong> ${strongIntent}/${total} utiliseraient certainement (${h4Percent}%)<br>
                    <strong>Conclusion :</strong> ${h4Validated ? 'Forte intention d\'achat. Les early adopters sont identifi√©s.' : 'L\'intention d\'achat est faible. Gap entre int√©r√™t et conversion √† combler.'}
                </div>
            </div>`;
            
            document.getElementById('hypothesesContainer').innerHTML = html;
            
            // Business Insights
            const validatedCount = [h1Validated, h2Validated, h3Validated, h4Validated].filter(Boolean).length;
            let insightsHtml = '<div class="insight-box"><h3>üí° Synth√®se Business</h3>';
            
            if (validatedCount === 4) {
                insightsHtml += `<p style="color: #28a745; font-weight: bold; font-size: 1.1em;">‚úÖ CONCEPT ENTI√àREMENT VALID√â (4/4 hypoth√®ses)</p>
                    <p style="margin-top: 15px;"><strong>Recommandations :</strong></p>
                    <ul style="margin-left: 20px; line-height: 1.8;">
                        <li>üöÄ D√©velopper le MVP en priorit√© sur les fonctionnalit√©s identifi√©es</li>
                        <li>üí∞ Lancer avec un pricing 12-15‚Ç¨/mois</li>
                        <li>üéØ Cibler les segments identifi√©s dans la segmentation</li>
                        <li>üìß Contacter les ${strongIntent} early adopters pour beta-test</li>
                        <li>üíº Pr√©parer une lev√©e de fonds avec ces donn√©es</li>
                    </ul>`;
            } else if (validatedCount >= 2) {
                insightsHtml += `<p style="color: #ffc107; font-weight: bold; font-size: 1.1em;">‚ö†Ô∏è CONCEPT PARTIELLEMENT VALID√â (${validatedCount}/4 hypoth√®ses)</p>
                    <p style="margin-top: 15px;"><strong>Recommandations :</strong></p>
                    <ul style="margin-left: 20px; line-height: 1.8;">
                        <li>üîç Approfondir les hypoth√®ses non valid√©es avec interviews qualitatives</li>
                        <li>üéØ Affiner le positionnement et la communication</li>
                        <li>üí° Tester diff√©rentes variantes du concept</li>
                        <li>üìä Collecter plus de r√©ponses pour confirmer les tendances</li>
                    </ul>`;
            } else {
                insightsHtml += `<p style="color: #dc3545; font-weight: bold; font-size: 1.1em;">‚ùå CONCEPT NON VALID√â (${validatedCount}/4 hypoth√®ses)</p>
                    <p style="margin-top: 15px;"><strong>Recommandations :</strong></p>
                    <ul style="margin-left: 20px; line-height: 1.8;">
                        <li>üîÑ Pivot n√©cessaire : repenser le concept</li>
                        <li>üé§ Interviews approfondies pour comprendre les freins</li>
                        <li>üí° Explorer d'autres angles ou positionnements</li>
                        <li>üìâ Ne pas investir avant validation du concept</li>
                    </ul>`;
            }
            
            insightsHtml += '</div>';
            document.getElementById('businessInsights').innerHTML = insightsHtml;
        }
        
        function renderDetailedStats() {
            const total = responses.length;
            if (total === 0) {
                document.getElementById('statsGrid').innerHTML = '';
                document.getElementById('chartsContainer').innerHTML = '<p>Aucune donn√©e √† afficher</p>';
                return;
            }
            
            let statsHtml = `<div class="stat-card"><div class="stat-label">R√©ponses totales</div><div class="stat-value">${total}</div></div>`;
            document.getElementById('statsGrid').innerHTML = statsHtml;
            
            let chartsHtml = '';
            questions.forEach(q => {
                if (q.type === 'text') return;
                const data = {};
                responses.forEach(r => {
                    let answer = r[q.id];
                    if (q.type === 'scale' && typeof answer === 'number') {
                        answer = q.options[answer];
                    }
                    if (q.type === 'multiple') {
                        (answer || []).forEach(a => {
                            data[a] = (data[a] || 0) + 1;
                        });
                    } else {
                        answer = answer || 'Non renseign√©';
                        data[answer] = (data[answer] || 0) + 1;
                    }
                });
                
                chartsHtml += `<div class="chart-section"><h3>${q.question}</h3>`;
                Object.entries(data).sort((a, b) => b[1] - a[1]).forEach(([answer, count]) => {
                    const percent = (count / total * 100).toFixed(0);
                    chartsHtml += `<div class="chart-bar"><div class="chart-label"><span>${answer}</span><span><strong>${count}</strong> (${percent}%)</span></div><div class="bar-container"><div class="bar-fill" style="width: ${percent}%">${percent}%</div></div></div>`;
                });
                chartsHtml += '</div>';
            });
            document.getElementById('chartsContainer').innerHTML = chartsHtml;
        }
        
        function renderSegmentation() {
            const total = responses.length;
            if (total === 0) {
                document.getElementById('segmentationContainer').innerHTML = '<p>Aucune donn√©e pour la segmentation</p>';
                return;
            }
            
            const segments = {};
            responses.forEach(r => {
                const profil = r.profil || 'Non renseign√©';
                if (!segments[profil]) {
                    segments[profil] = { count: 0, highInterest: 0, strongIntent: 0, avgLoss: [] };
                }
                segments[profil].count++;
                if (r.interet === 'Tr√®s int√©ress√©(e)' || r.interet === 'Extr√™mement int√©ress√©(e)' || r.interet === 2 || r.interet === 3) {
                    segments[profil].highInterest++;
                }
                if (r.utilisation === 'Oui, certainement') {
                    segments[profil].strongIntent++;
                }
                if (r.perte_argent) segments[profil].avgLoss.push(r.perte_argent);
            });
            
            let html = '<h2>üë• Segmentation des personas</h2>';
            Object.entries(segments).forEach(([profil, data]) => {
                const interestRate = (data.highInterest / data.count * 100).toFixed(0);
                const intentRate = (data.strongIntent / data.count * 100).toFixed(0);
                html += `<div class="insight-box"><h3>${profil} (${data.count} r√©ponses)</h3>
                    <p><strong>Taux d'int√©r√™t √©lev√© :</strong> ${interestRate}% (${data.highInterest}/${data.count})</p>
                    <p><strong>Intention d'achat forte :</strong> ${intentRate}% (${data.strongIntent}/${data.count})</p>
                    <p style="margin-top: 10px;">${interestRate >= 50 ? 'üéØ <strong>Segment prioritaire</strong> √† cibler' : '‚ö™ Segment secondaire'}</p>
                </div>`;
            });
            document.getElementById('segmentationContainer').innerHTML = html;
        }
        
        function saveConfig() {
            GOOGLE_SCRIPT_URL = document.getElementById('googleScriptUrl').value;
            localStorage.setItem(GOOGLE_URL_KEY, GOOGLE_SCRIPT_URL);
            alert('‚úÖ Configuration sauvegard√©e !');
        }
        
        function changePassword() {
            const newPass = document.getElementById('newPassword').value;
            if (newPass.length < 4) {
                alert('‚ö†Ô∏è Le mot de passe doit contenir au moins 4 caract√®res');
                return;
            }
            adminPassword = newPass;
            localStorage.setItem(ADMIN_PASSWORD_KEY, newPass);
            document.getElementById('newPassword').value = '';
            alert('‚úÖ Mot de passe modifi√© !');
        }
        
        function clearAllData() {
            if (confirm('‚ö†Ô∏è ATTENTION : Cela va supprimer TOUTES les r√©ponses collect√©es. Cette action est irr√©versible. Continuer ?')) {
                responses = [];
                localStorage.setItem(RESPONSES_KEY, JSON.stringify(responses));
                analyzeHypotheses();
                alert('‚úÖ Toutes les donn√©es ont √©t√© effac√©es');
            }
        }
        
        function exportCSV() {
            if (responses.length === 0) {
                alert('Aucune donn√©e √† exporter');
                return;
            }
            let csv = 'Date;';
            csv += questions.map(q => q.question.replace(/;/g, ',')).join(';') + '\n';
            responses.forEach(r => {
                csv += new Date(r.timestamp).toLocaleString('fr-FR') + ';';
                csv += questions.map(q => {
                    let answer = r[q.id];
                    if (q.type === 'scale' && typeof answer === 'number') answer = q.options[answer];
                    if (q.type === 'multiple') answer = (answer || []).join(' | ');
                    return (answer || '').toString().replace(/;/g, ',');
                }).join(';') + '\n';
            });
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'business_experimentation_' + new Date().toISOString().split('T')[0] + '.csv';
            link.click();
        }
    </script>
</body>
</html>